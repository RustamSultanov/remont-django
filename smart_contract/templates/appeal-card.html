{% extends "imp_base.html" %}
{% load static %}
{% load mptt_tags %}
 {% block script %}
<!-- Libs -->
	<link rel="stylesheet" href="{% static "assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" %}">
	<link rel="stylesheet" href="{% static "assets/vendor/libs/dragula/dragula.css" %}">
	<link rel="stylesheet" href="{% static "assets/vendor/libs/datatables/datatables.css" %}">
	<!-- Page -->
	<link rel="stylesheet" href="{% static "assets/vendor/css/pages/projects.css" %}">
		<link rel="stylesheet" href="{% static "assets/vendor/css/pages/chat.css" %}">
	<link rel="stylesheet" href="{% static "assets/css/custom.css" %}">
        {% endblock %}


{% block content %}
{% csrf_token %}

			<!-- Layout content -->
			<div class="layout-content">

				<!-- Content -->
				<div class="container flex-grow-1 container-p-y orders-card">
					<h4 class="py-3 mb-4">
						<ol class="breadcrumb font-weight-bold m-0">
							<li class="breadcrumb-item"><a href="{% url 'appeal_list' %}">Обращения</a></li>
							<li class="breadcrumb-item active">Обращение: {{ appeal.id }}</small></li>
						</ol>
					</h4>

					<div class="row">
						<div class="col">
							<div class="card">
								<div class="row no-gutters row-bordered mb-5">
									<div class="d-flex col-lg-4">

										<div class="card-body d-flex flex-column">
											<h6>Обращение</h6>
											<span>ID: <span class="font-weight-light text-secondary">{{ appeal.user.id }}</span></span>
											<span>Имя: <span class="font-weight-light text-secondary">{{ appeal.user.first_name }}</span></span>
											<span>Фамилия: <span class="text-muted font-italic font-weight-light">скрыто</span></span>
											<span>Почта: <span class="text-muted font-italic font-weight-light">скрыто</span></span>
											<span>Дата обращения: <span class="font-weight-light text-secondary">{{ appeal.date_create }}</span></span>
											<span>Источник: <span class="font-weight-light text-secondary">Виджет на сайте <i class="icon ion-md-text ml-1"></i></span></span>
											<!-- <span>IP: <span class="font-weight-light text-secondary">Московская область</span></span> -->
										</div>

									</div>
									<div class="d-flex col-lg-4">

										<div class="card-body d-flex flex-column">
											<h6>Услуга</h6>
											<a href="javascript:void(0)" class="">{% recursetree rubricator %} {{ node.name }} {{ children }} 
											{% endrecursetree %}</a>
											<span>M<sup>2</sup>: <span class="font-weight-light text-secondary">{{ appeal.size }}</span></span>
											<span>Комментарий: <span class="font-weight-light text-secondary">{{ appeal.text }}</span></span>
										</div>

									</div>
									<div class="d-flex col-lg-4">

										<div class="card-body d-flex flex-column">
											<h6>Действия</h6>

											<a href="{% url 'appeal_accept' appeal.id %}" class="btn btn-success mb-3">Создать заказ</a>

											<a href="{% url 'appeal_failure' appeal.id %}" class="btn btn-danger btn-sm">Отказаться от предложения</a>



										</div>

									</div>
								</div>
								<!-- Чат -->
								<div class="chat-wrapper" style="min-height: 700px">

									<!-- Make card full height of `.chat-wrapper` -->
									<div class="card flex-grow-1 position-relative overflow-hidden">

										<!-- Make row full height of `.card` -->
										<div class="row no-gutters h-100">
											<!--<div class="chat-sidebox col">

												&lt;!&ndash; Chat contacts header &ndash;&gt;
												<div class="flex-grow-0 px-4">
													<div class="media align-items-center">
														<div class="media-body">
															<input type="text" class="form-control chat-search my-3" placeholder="Search...">
														</div>
														<a href="javascript:void(0)" class="chat-sidebox-toggler d-lg-none d-block text-muted text-large font-weight-light pl-3">&times;</a>
													</div>
													<hr class="border-light m-0">
												</div>
												&lt;!&ndash; / Chat contacts header &ndash;&gt;

												&lt;!&ndash; Wrap `.chat-scroll` to properly position scroll area. Remove this wtapper if you don't need scroll &ndash;&gt;
												<div class="flex-grow-1 position-relative">
													<div class="chat-contacts list-group chat-scroll py-3">

														&lt;!&ndash; Online &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action online">
															<img src="assets/img/avatars/2-small.png" class="d-block ui-w-40 rounded-circle" alt="">
															<div class="media-body ml-3">
																Leon Wilson
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Online</div>
															</div>
															<div class="badge badge-outline-success">5</div>
														</a>

														&lt;!&ndash; Online &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action online">
															<img src="assets/img/avatars/3-small.png" class="d-block ui-w-40 rounded-circle" alt="">
															<div class="media-body ml-3">
																Allie Rodriguez
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Online</div>
															</div>
														</a>

														&lt;!&ndash; Online & Active &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action online active">
															<img src="assets/img/avatars/4-small.png" class="d-block ui-w-40 rounded-circle" alt="">
															<div class="media-body ml-3">
																Kenneth Frazier
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Online</div>
															</div>
														</a>

														&lt;!&ndash; Online &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action online">
															<img src="assets/img/avatars/5-small.png" class="d-block ui-w-40 rounded-circle" alt="">
															<div class="media-body ml-3">
																Nellie Maxwell
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Online</div>
															</div>
															<div class="badge badge-outline-success">2</div>
														</a>

														&lt;!&ndash; Online &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action online">
															<img src="assets/img/avatars/6-small.png" class="d-block ui-w-40 rounded-circle" alt="">
															<div class="media-body ml-3">
																Mae Gibson
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Online</div>
															</div>
														</a>

														&lt;!&ndash; Offline &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action">
															<img src="assets/img/avatars/7-small.png" class="d-block ui-w-40 rounded-circle" alt=""> 
															<div class="media-body ml-3">
																Alice Hampton
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Offline</div>
															</div>
														</a>

														&lt;!&ndash; Offline &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action">
															<img src="assets/img/avatars/8-small.png" class="d-block ui-w-40 rounded-circle" alt=""> 
															<div class="media-body ml-3">
																Hallie Lewis
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Offline</div>
															</div>
															<div class="badge badge-outline-success">1</div>
														</a>

														&lt;!&ndash; Offline &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action">
															<img src="assets/img/avatars/9-small.png" class="d-block ui-w-40 rounded-circle" alt=""> 
															<div class="media-body ml-3">
																Amanda Warner
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Offline</div>
															</div>
														</a>

														&lt;!&ndash; Offline &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action">
															<img src="assets/img/avatars/10-small.png" class="d-block ui-w-40 rounded-circle" alt=""> 
															<div class="media-body ml-3">
																Wayne Morgan
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Offline</div>
															</div>
														</a>

														&lt;!&ndash; Offline &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action">
															<img src="assets/img/avatars/11-small.png" class="d-block ui-w-40 rounded-circle" alt=""> 
															<div class="media-body ml-3">
																Belle Ross
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Offline</div>
															</div>
														</a>

														&lt;!&ndash; Offline &ndash;&gt;
														<a href="javascript:void(0)" class="list-group-item list-group-item-action">
															<img src="assets/img/avatars/12-small.png" class="d-block ui-w-40 rounded-circle" alt=""> 
															<div class="media-body ml-3">
																Arthur Duncan
																<div class="chat-status small"><span class="badge badge-dot"></span>&nbsp; Offline</div>
															</div>
														</a>

													</div>&lt;!&ndash; / .chat-contacts &ndash;&gt;
												</div>

											</div>-->
											<div class="d-flex col flex-column">

												<!-- Chat header -->
												<div class="flex-grow-0 py-3 pr-4 pl-lg-4">

													<div class="media align-items-center">
														<a href="javascript:void(0)" class="chat-sidebox-toggler d-lg-none d-block text-muted text-large px-4 mr-2"><i class="ion ion-md-more"></i></a>

														<!-- <div class="position-relative">
															<span class="badge badge-dot badge-success indicator"></span>
															<img src="assets/img/avatars/4-small.png" class="ui-w-40 rounded-circle" alt="">
														</div>
														<div class="media-body pl-3">
															<strong>Kenneth Frazier</strong>
															<div class="text-muted small"><em>Typing...</em></div>
														</div> -->
														<!--						<div>
																					<button type="button" class="btn btn-primary btn-round icon-btn mr-1"><i class="ion ion-ios-call"></i></button>
																					<button type="button" class="btn btn-secondary btn-round icon-btn mr-1"><i class="ion ion-md-videocam"></i></button>
																					<button type="button" class="btn btn-default btn-round icon-btn"><i class="ion ion-ios-more"></i></button>
																				</div>-->
													</div>

												</div>
												<hr class="flex-grow-0 border-light m-0">
												<!-- / Chat header -->

												<!-- Wrap `.chat-scroll` to properly position scroll area. Remove this wtapper if you don't need scroll -->
												<div class="flex-grow-1 position-relative">

													<!-- Remove `.chat-scroll` and add `.flex-grow-1` if you don't need scroll -->
													<div class="chat-messages chat-scroll p-4">
														{% for messege in messeges %}
 
														{% if messege.user == request.user %}
 <div class="chat-message-right mb-4"> 	
															<div>
															{% if messege.user.useraccept.avatar %}	<img src="{{ messege.user.useraccept.avatar.url }}" class="ui-w-40 rounded-circle" alt>{% else %}{% endif %}
																<div class="text-muted small text-nowrap mt-2">{{ messege.date_create }}</div>
															</div>
															<div class="flex-shrink-1 bg-lighter rounded py-2 px-3 mr-3">
																<div class="font-weight-semibold mb-1">Вы</div>
																{{ messege.text }}
															</div>
														</div>
														{% else %}
<div class="chat-message-left mb-4">
	<div>
																 {% if messege.user.useraccept.avatar %}
<img src="{{ messege.user.useraccept.avatar.url }}" class="ui-w-40 rounded-circle" alt>{% else %}{% endif %}
																<div class="text-muted small text-nowrap mt-2">{{ messege.date_create }}</div>
															</div>
															<div class="flex-shrink-1 bg-lighter rounded py-2 px-3 mr-3">
																<div class="font-weight-semibold mb-1">{{ messege.accepter.get_full_name }}</div>
																{{ messege.text }}
															</div>
														</div>
 	{% endif %}
{% endfor %} 
													

													</div><!-- / .chat-messages -->
												</div>

												<!-- Chat footer -->
												<hr class="border-light m-0">
												<div class="flex-grow-0 py-3 px-4">
													<form action="" method="post">    {% csrf_token %} 


														<div class="input-group mb-3">
															 {{ form.text }}
															<div class="input-group-append">
														<button type="submit" class="btn btn-success">Отправить</button>
															</div>
														</div>
														<!-- <div class="upload_form form-group">
															<p class="mb-0">Загрузить файл</p>
															<label>
																<input name="file" type="file" class="main_input_file" />
																<div class="btn btn-success">Выбрать файл</div>
																<input class="f_name" type="text" id="f_name" value="Файл не выбран." disabled />
															</label>
														</div> -->
													</form>

												</div>
												<!-- / Chat footer -->

											</div>
										</div><!-- / .row -->

									</div><!-- / .card -->

								</div>
								<!-- Кнопки -->
								<div class="card-body">
									<a href="{% url 'appeal_accept' appeal.id %}" class="btn btn-success mr-2">Создать заказ</a>

									<a href="{% url 'appeal_failure' appeal.id %}" class="btn btn-danger">Отказаться от решения</a>
								</div>
							</div>
						</div>
					</div>
 

	
{% block script2 %}

<script src="{% static "assets/vendor/libs/dragula/dragula.js" %}"></script>
<script src="{% static "assets/vendor/libs/datatables/datatables.js" %}"></script>

<!-- Custom -->
<script src="{% static "assets/js/pages_projects_item.js" %}"></script>
<script src="{% static "assets/js/pages_chat.js" %}"></script>
<script src="{% static "assets/js/tables_datatables.js" %}"></script>
{% endblock %}

{% endblock %}



